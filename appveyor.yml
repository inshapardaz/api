version: 1.0.{build}
max_jobs: 1
image: Visual Studio 2019
branches:
  # whitelist
  only:
    - master
skip_tags: true
skip_branch_with_pr: true

#Before the build starts
before_build:
- cmd: dotnet restore ./Inshapardaz.Api.sln

# Building
build_script:
  - cmd: dotnet publish -c Release src/Inshapardaz.Functions/Inshapardaz.Functions.csproj

# Testing
test_script:
- cmd: cd src/Inshapardaz.Functions.Tests
- cmd: dotnet test

# Create artifacts
artifacts:
- path: src/Inshapardaz.Functions
  name: Function

# Deployment
deploy:
- provider: WebDeploy
  server: https://api-inshapardaz.scm.azurewebsites.net:443/msdeploy.axd?site=api-inshapardaz
  website: api-inshapardaz
  username: $api-inshapardaz
  password:
    secure: JtybVbpTxTWp21oT11L4dL7KzpGW6DAovgmyo4Gw9iX0wKUuZd2vzN7t6stoUucU7tyLCFHsCEQ3yiiiulR18A==
  artifact: Function
  on:
    branch: master
